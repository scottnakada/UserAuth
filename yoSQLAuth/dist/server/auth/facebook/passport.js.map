{"version":3,"sources":["../../../../server/auth/facebook/passport.js"],"names":[],"mappings":";;;;wBAAqB,UAAU;;;;gCACY,mBAAmB;;AAE9D,OAAO,CAAC,KAAK,GAAG,UAAS,IAAI,EAAE,MAAM,EAAE;AACrC,wBAAS,GAAG,CAAC,+BAAqB;AAChC,YAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,QAAQ;AAClC,gBAAY,EAAE,MAAM,CAAC,QAAQ,CAAC,YAAY;AAC1C,eAAW,EAAE,MAAM,CAAC,QAAQ,CAAC,WAAW;AACxC,iBAAa,EAAE,CACb,aAAa,EACb,QAAQ,CACT;GACF,EACD,UAAS,WAAW,EAAE,YAAY,EAAE,OAAO,EAAE,IAAI,EAAE;AACjD,QAAI,CAAC,IAAI,CAAC;AACR,mBAAa,EAAE,OAAO,CAAC,EAAE;KAC1B,CAAC,CACC,IAAI,CAAC,UAAS,IAAI,EAAE;AACnB,UAAI,CAAC,IAAI,EAAE;AACT,YAAI,GAAG,IAAI,CAAC,KAAK,CAAC;AAChB,cAAI,EAAE,OAAO,CAAC,WAAW;AACzB,eAAK,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK;AAC9B,cAAI,EAAE,MAAM;AACZ,kBAAQ,EAAE,UAAU;AACpB,kBAAQ,EAAE,OAAO,CAAC,KAAK;SACxB,CAAC,CAAC;AACH,YAAI,CAAC,IAAI,EAAE,CACR,IAAI,CAAC,UAAS,IAAI,EAAE;AACnB,iBAAO,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;SACzB,CAAC,SACI,CAAC,UAAS,GAAG,EAAE;AACnB,iBAAO,IAAI,CAAC,GAAG,CAAC,CAAC;SAClB,CAAC,CAAC;OACN,MAAM;AACL,eAAO,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;OACzB;KACF,CAAC,SACI,CAAC,UAAS,GAAG,EAAE;AACnB,aAAO,IAAI,CAAC,GAAG,CAAC,CAAC;KAClB,CAAC,CAAC;GACN,CAAC,CAAC,CAAC;CACL,CAAC","file":"passport.js","sourcesContent":["import passport from 'passport';\nimport {Strategy as FacebookStrategy} from 'passport-facebook';\n\nexports.setup = function(User, config) {\n  passport.use(new FacebookStrategy({\n    clientID: config.facebook.clientID,\n    clientSecret: config.facebook.clientSecret,\n    callbackURL: config.facebook.callbackURL,\n    profileFields: [\n      'displayName',\n      'emails'\n    ]\n  },\n  function(accessToken, refreshToken, profile, done) {\n    User.find({\n      'facebook.id': profile.id\n    })\n      .then(function(user) {\n        if (!user) {\n          user = User.build({\n            name: profile.displayName,\n            email: profile.emails[0].value,\n            role: 'user',\n            provider: 'facebook',\n            facebook: profile._json\n          });\n          user.save()\n            .then(function(user) {\n              return done(null, user);\n            })\n            .catch(function(err) {\n              return done(err);\n            });\n        } else {\n          return done(null, user);\n        }\n      })\n      .catch(function(err) {\n        return done(err);\n      });\n  }));\n};\n"]}